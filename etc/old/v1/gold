#!/usr/bin/env bash

Bin=$HOME/opt/gold/bin
mkdir -p $Bin 

File=${1##*/}  
Stem=${File%.*}

(echo "#!/usr/bin/env gawk -f"
 gawk -f $(PWD)/lib/gold2awk.awk $1
 Main=${Stem}Main
 echo 'BEGIN { if("'${Main}'" in FUNCTAB) {'${Main}'(); rogues()}}'
) > $Bin/$Stem

chmod +x $Bin/$Stem

if [ "$2" ==  "make" ]
then 
  true
else
  shift
  if    [ ! -t 0 ]
  then  cat - |  $Bin/$Stem $*
  else  $Bin/$Stem $*
  fi
fi
